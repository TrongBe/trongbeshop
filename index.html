<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trong Be Clothing - Th·ªùi Trang Ph√°i ƒê·∫πp</title>
  <link rel="stylesheet" href="css/style.css">
  <!-- Icon (Optional) -->
  <link rel="icon" href="https://img.icons8.com/color/48/clothes.png" type="image/png">
</head>

<body>

  <header>
    <div class="header-container">
      <h1>Trong Be Shop</h1>
      <p>Elegant & Stylish ‚Ä¢ Th·ªùi Trang N·ªØ</p>
    </div>
  </header>

  <div class="hero">
    <div class="hero-content">
      <h2>Phong C√°ch Hi·ªán ƒê·∫°i</h2>
      <p>Kh√°m ph√° b·ªô s∆∞u t·∫≠p m·ªõi nh·∫•t d√†nh cho b·∫°n</p>
    </div>
  </div>

  <div class="container" id="product-list">
    <!-- Loader -->
    <div class="loader">
      <p>ƒêang t·∫£i s·∫£n ph·∫©m m·ªõi nh·∫•t...</p>
    </div>
  </div>

  <!-- POPUP FORM -->
  <div id="overlay">
    <div id="orderForm">
      <div class="close-btn" onclick="closeForm()">√ó</div>

      <h3>ƒê·∫∑t H√†ng Ngay</h3>
      <div style="text-align: center; margin-bottom: 20px;">
        <p><b id="productName" style="font-size: 1.1em;"></b></p>
        <p style="color: var(--discount-bg); font-weight: bold; font-size: 1.2em; margin-top: 5px;" id="totalText"></p>
      </div>

      <div class="form-group">
        <input id="name" placeholder="H·ªç v√† t√™n c·ªßa b·∫°n" required>
      </div>
      <div class="form-group">
        <input id="phone" placeholder="S·ªë ƒëi·ªán tho·∫°i" required>
      </div>
      <div class="form-group">
        <input id="address" placeholder="ƒê·ªãa ch·ªâ giao h√†ng" required>
      </div>
      <div class="form-group">
        <textarea id="note" rows="3" placeholder="Ghi ch√∫ (Size, M√†u s·∫Øc, v.v.)"></textarea>
      </div>

      <button class="order-btn" onclick="sendOrder()">X√°c Nh·∫≠n ƒê·∫∑t H√†ng</button>
    </div>
  </div>

  <footer>
    <div class="footer-content">
      <p>üìç <b>ƒê·ªãa ch·ªâ:</b> T·ªï 4, khu ph·ªë Trung L·ª£i, ph∆∞·ªùng Ch∆°n Th√†nh, t·ªânh ƒê·ªìng Nai</p>
      <p>üìû <b>Hotline:</b> 0977 162 967</p>
      <p>üìß <b>Email:</b> nguyentrong0398787723@gmail.com</p>
      <br>
      <p style="font-size: 0.8rem; opacity: 0.6;">¬© 2026 Trong Be Shop. All rights reserved.</p>
    </div>
  </footer>

  <script>
    let product = "";
    let price = 0;

    // Link Google Sheet (PUBLISHED CSV)
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQZqtzNLbYo3eWDB7XAkPqULetvxmHCYpz0_Eh8qiGeZL1O4GchB8klv9xXh_9pzhXhdo4RvkbvGsbT/pub?output=csv";

    fetch(SHEET_URL)
      .then(res => res.text())
      .then(data => {
        const rows = data.trim().split("\n").slice(1);
        let html = "";

        rows.forEach(row => {
          if (!row.trim()) return;

          // Parse CSV properly handling quotes if needed (Same logic as before)
          // Simple split logic for now as per original
          const cols = row.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);

          if (!cols || cols.length < 6) return;

          const id = cols[0].replace(/"/g, "");
          const name = cols[1].replace(/"/g, "");
          const image = cols[2].replace(/"/g, "");
          const sale = cols[3].replace(/"/g, "");
          const old = cols[4].replace(/"/g, "");
          const discount = cols[5].replace(/"/g, "");

          html += `
                        <div class="product">
                             <div class="discount-badge">-${discount}%</div>
                             <img src="${image}" alt="${name}" loading="lazy">
                             <h3>${name}</h3>

                             <div class="price-box">
                                 <span class="sale-price">${Number(sale).toLocaleString("vi-VN")}ƒë</span>
                                 <span class="old-price">${Number(old).toLocaleString("vi-VN")}ƒë</span>
                             </div>

                             <div class="btn-group">
                                 <button class="btn buy-btn" 
                                     data-name="[M√£ ${id}] ${name}" 
                                     data-price="${sale}">
                                     MUA NGAY
                                 </button>
                                 <button class="btn zalo-btn" onclick="openZalo()">
                                     Chat Zalo
                                 </button>
                             </div>
                        </div>
                    `;
        });

        document.getElementById("product-list").innerHTML = html;

        // Add Event Listeners
        document.querySelectorAll(".buy-btn").forEach(btn => {
          btn.addEventListener("click", () => {
            const p = btn.dataset.name;
            const pr = Number(btn.dataset.price);
            openForm(p, pr);
          });
        });
      })
      .catch(err => {
        console.error("L·ªói:", err);
        document.getElementById("product-list").innerHTML = "<p>L·ªói t·∫£i gi·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i sau.</p>";
      });

    // Functions
    function openForm(p, pr) {
      product = p;
      price = pr;
      document.getElementById("productName").innerText = product;
      document.getElementById("totalText").innerText = price.toLocaleString("vi-VN") + " ƒë";
      document.getElementById("overlay").style.display = "block";
    }

    function closeForm() {
      document.getElementById("overlay").style.display = "none";
    }

    function openZalo() {
      window.open("http://zaloapp.com/qr/p/zrdh0azjcnbr", "_blank");
    }

    function sendOrder() {
      const name = document.getElementById("name").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const address = document.getElementById("address").value.trim();
      const note = document.getElementById("note").value.trim();

      if (!name || !phone || !address) {
        alert("Vui l√≤ng ƒëi·ªÅn t√™n, s·ªë ƒëi·ªán tho·∫°i v√† ƒë·ªãa ch·ªâ nh·∫≠n h√†ng.");
        return;
      }

      const formURL = "https://docs.google.com/forms/d/e/1FAIpQLSe2QVBkjkEvnfdcduCh0TOHPB6qw1kmZsFSVSVb26-E1oQ__A/formResponse";

      const data = new FormData();
      data.append("entry.2117813281", name);
      data.append("entry.1913338152", phone);
      data.append("entry.1464387788", address);
      data.append("entry.1384420991", product);
      data.append("entry.535808915", note);

      // Change button state
      const btn = document.querySelector(".order-btn");
      const originalText = btn.innerText;
      btn.innerText = "ƒêang g·ª≠i...";
      btn.disabled = true;

      fetch(formURL, { method: "POST", mode: "no-cors", body: data })
        .then(() => {
          alert("üéâ ƒê·∫∑t h√†ng th√†nh c√¥ng! Shop s·∫Ω li√™n h·ªá s·ªõm.");
          closeForm();
          // Reset form
          document.getElementById("name").value = "";
          document.getElementById("phone").value = "";
          document.getElementById("address").value = "";
          document.getElementById("note").value = "";
        })
        .catch(err => alert("L·ªói g·ª≠i ƒë∆°n, vui l√≤ng th·ª≠ l·∫°i!"))
        .finally(() => {
          btn.innerText = originalText;
          btn.disabled = false;
        });
    }

    // Close modal on outside click
    window.onclick = function (event) {
      if (event.target == document.getElementById("overlay")) {
        closeForm();
      }
    }
  </script>

</body>

</html>